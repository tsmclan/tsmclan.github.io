<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>/*GitHub*/
.highlight {background-color:#fff;color:#333333;}
.highlight .hll {background-color:#ffffcc;}
.highlight .c{color:#999988;font-style:italic}
.highlight .err{color:#a61717;background-color:#e3d2d2}
.highlight .k{font-weight:bold}
.highlight .o{font-weight:bold}
.highlight .cm{color:#999988;font-style:italic}
.highlight .cp{color:#999999;font-weight:bold}
.highlight .c1{color:#999988;font-style:italic}
.highlight .cs{color:#999999;font-weight:bold;font-style:italic}
.highlight .gd{color:#000000;background-color:#ffdddd}
.highlight .ge{font-style:italic}
.highlight .gr{color:#aa0000}
.highlight .gh{color:#999999}
.highlight .gi{color:#000000;background-color:#ddffdd}
.highlight .go{color:#888888}
.highlight .gp{color:#555555}
.highlight .gs{font-weight:bold}
.highlight .gu{color:#800080;font-weight:bold}
.highlight .gt{color:#aa0000}
.highlight .kc{font-weight:bold}
.highlight .kd{font-weight:bold}
.highlight .kn{font-weight:bold}
.highlight .kp{font-weight:bold}
.highlight .kr{font-weight:bold}
.highlight .kt{color:#445588;font-weight:bold}
.highlight .m{color:#009999}
.highlight .s{color:#dd1144}
.highlight .n{color:#333333}
.highlight .na{color:teal}
.highlight .nb{color:#0086b3}
.highlight .nc{color:#445588;font-weight:bold}
.highlight .no{color:teal}
.highlight .ni{color:purple}
.highlight .ne{color:#990000;font-weight:bold}
.highlight .nf{color:#990000;font-weight:bold}
.highlight .nn{color:#555555}
.highlight .nt{color:navy}
.highlight .nv{color:teal}
.highlight .ow{font-weight:bold}
.highlight .w{color:#bbbbbb}
.highlight .mf{color:#009999}
.highlight .mh{color:#009999}
.highlight .mi{color:#009999}
.highlight .mo{color:#009999}
.highlight .sb{color:#dd1144}
.highlight .sc{color:#dd1144}
.highlight .sd{color:#dd1144}
.highlight .s2{color:#dd1144}
.highlight .se{color:#dd1144}
.highlight .sh{color:#dd1144}
.highlight .si{color:#dd1144}
.highlight .sx{color:#dd1144}
.highlight .sr{color:#009926}
.highlight .s1{color:#dd1144}
.highlight .ss{color:#990073}
.highlight .bp{color:#999999}
.highlight .vc{color:teal}
.highlight .vg{color:teal}
.highlight .vi{color:teal}
.highlight .il{color:#009999}
.highlight .gc{color:#999;background-color:#EAF2F5}
</style><title>rsync</title></head><body><article class="markdown-body"><p><link type="image/x-icon" rel="shortcut icon" href="/favicon.ico" />
<link href="/_assets/font-awesome.css" rel="stylesheet"/>
<link href="/_assets/prismjs.css" rel="stylesheet" />
<link href="/_assets/markdown.css" rel="stylesheet" />
<script src="/_assets/prism.js"></script>
<!-- NOTE: There are several steps that are taken to release the html document -->
<!-- Step 1: remove the title, head, article tags generated by MarkdownPreview -->
<!-- Step 2: uncomment the following lines for enabling MathJax script -->
<!-- <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    TeX: { equationNumbers: { autoNumber: "AMS" } },
    tex2jax: {inlineMath: [["$","$"]]}
  });
</script>
<script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/3.0.5/es5/tex-mml-chtml.js"></script> --></p>
<!-- Step 3: uncomment the following lines for enabling toggle-toc script -->

<!-- <script type="text/javascript" src="/_assets/jquery.min.js"></script>
<script>
$(document).ready(function(){
  $(".toc-toggle").click(function(){
    $('body').toggleClass('with-toc');
  });
});
</script> -->

<p><title>Software Engineering</title>
<!-- Step 1.1: uncomment the next line when revising the head tag in Step 1 -->
<!-- <body class="with-toc"><article class="markdown-body"> --></p>
<h1 id="windowsrsync">Windows配置和使用rsync<a class="headerlink" href="#windowsrsync" title="Permanent link"></a></h1>
<p>在Windows上也可用rsync进行代码/数据集同步。参见<a href="https://www.cnblogs.com/zeq912/p/9593931.html">CentOS7下rsync服务的基本详解和使用</a>和<a href="https://www.ubackup.com/tw/windows-10/rsync-windows-10.html">如何在Windows 10 中使用Rsync |教程和替代方案</a>。</p>
<h1 id="1-zstd">1. 安装 zstd<a class="headerlink" href="#1-zstd" title="Permanent link"></a></h1>
<p>Zstd 是用来解压 .zst 格式的压缩包的，因为我们下载的 rsync 程序包就是 .zst 格式的压缩包，因此我们需要先安装 zstd</p>
<!-- <img href="/_resources/" alt=" " style="zoom:50%;" />
`注意：因为本人的电脑没有 GPU ，故跑不了代码，本项目所有代码都是在 Linux  下运行的，如果你的电脑（Win 操作系统想要运行本代码，可以安装 Git 软件来执行 Linux 命令）` -->

<h2 id="11">1.1 下载<a class="headerlink" href="#11" title="Permanent link"></a></h2>
<p>下载地址 <a href="https://github.com/facebook/zstd/release">https://github.com/facebook/zstd/release</a> ，选择 Windows 版本的压缩包下载。如：zstd-v1.5.4-win64.zip</p>
<h2 id="12">1.2 配置<a class="headerlink" href="#12" title="Permanent link"></a></h2>
<p>下载完成后解压，并将解压后的目录添加到系统环境变量 PATH 中，这样就可以在 cmd 或者 Powershell 中直接运行 zstd 命令</p>
<h2 id="13">1.3 测试<a class="headerlink" href="#13" title="Permanent link"></a></h2>
<div class="highlight"><pre><span class="nv">$ </span>zstd -h   <span class="c1"># 查看zstd帮助手册</span>
</pre></div>

<h1 id="2-rsync">2. rsync下载<a class="headerlink" href="#2-rsync" title="Permanent link"></a></h1>
<h2 id="21">2.1 下载<a class="headerlink" href="#21" title="Permanent link"></a></h2>
<p>下载地址：
<a href="https://repo.msys2.org/msys/x86_64/rsync-3.2.7-2-x86_64.pkg.tar.zst">https://repo.msys2.org/msys/x86_64/rsync-3.2.7-2-x86_64.pkg.tar.zst</a></p>
<h2 id="22">2.2 解压<a class="headerlink" href="#22" title="Permanent link"></a></h2>
<p>在下载目录下打开 Powershell ，使用 zstd -d 命令解压 .zst 压缩包
<div class="highlight"><pre>zstd -d .<span class="se">\r</span>sync-3.2.7-2-x86_64.pkg.tar.zst <span class="c1"># 第一步解压</span>
</pre></div>
zstd 解压后得到 .tar 格式的压缩包，在 Windows 下使用系统自带的解压缩工具再次解压</p>
<h2 id="23-git">2.3 添加至 git<a class="headerlink" href="#23-git" title="Permanent link"></a></h2>
<p>将刚刚解压的 rsync 的相关文件复制到 Git 安装目录的对应位置，如：</p>
<div class="highlight"><pre>F:<span class="se">\E</span>D<span class="se">\r</span>sync-3.2.7-2-x86_64.pkg<span class="se">\u</span>sr<span class="se">\b</span>in --&gt; D:<span class="se">\G</span>it<span class="se">\u</span>sr<span class="se">\b</span>in  
F:<span class="se">\E</span>D<span class="se">\r</span>sync-3.2.7-2-x86_64.pkg<span class="se">\u</span>sr<span class="se">\l</span>ib --&gt; D:<span class="se">\G</span>it<span class="se">\u</span>sr<span class="se">\l</span>ib  
F:<span class="se">\E</span>D<span class="se">\r</span>sync-3.2.7-2-x86_64.pkg<span class="se">\u</span>sr<span class="se">\s</span>hare --&gt; D:<span class="se">\G</span>it<span class="se">\u</span>sr<span class="se">\s</span>hare
</pre></div>

<h2 id="24">2.4 测试<a class="headerlink" href="#24" title="Permanent link"></a></h2>
<div class="highlight"><pre><span class="c1">#查看版本号  </span>
rsync --version  
<span class="c1">#查看帮助信息  </span>
rsync -h
</pre></div>

<h2 id="25">2.5 遇到的问题<a class="headerlink" href="#25" title="Permanent link"></a></h2>
<p>A. 打开 Git Bash ，运行 rsync -v ，如果报 msys-zstd-1.dll not found，则下载 libzstd 链接库，下载地址
<a href="https://repo.msys2.org/msys/x86_64/libzstd-1.5.4-1-x86_64.pkg.tar.zst">https://repo.msys2.org/msys/x86_64/libzstd-1.5.4-1-x86_64.pkg.tar.zst</a>
解压方法同上第二小点，解压后将 libzstd 相关文件复制到 Git 安装目录的对应位置，如：
<div class="highlight"><pre>F:<span class="se">\E</span>D<span class="se">\l</span>ibzstd-1.5.4-1-x86_64.pkg<span class="se">\u</span>sr<span class="se">\b</span>in --&gt; D:<span class="se">\G</span>it<span class="se">\u</span>sr<span class="se">\b</span>in
</pre></div></p>
<p>B. 重新运行，如果报 msys-xxhash-0.dll not found ，
则下载 libxxhash 链接库，下载地址：
<a href="https://repo.msys2.org/msys/x86_64/libxxhash-0.8.1-1-x86_64.pkg.tar.zst">https://repo.msys2.org/msys/x86_64/libxxhash-0.8.1-1-x86_64.pkg.tar.zst</a>
解压方法同上第二小点，解压后将 libxxhash 相关文件复制到 Git 安装目录的对应位置，如
：
<div class="highlight"><pre>F:<span class="se">\E</span>D<span class="se">\l</span>ibxxhash-0.8.1-1-x86_64.pkg<span class="se">\u</span>sr<span class="se">\b</span>in --&gt; D:<span class="se">\G</span>it<span class="se">\u</span>sr<span class="se">\b</span>in    
F:<span class="se">\E</span>D<span class="se">\l</span>ibxxhash-0.8.1-1-x86_64.pkg<span class="se">\u</span>sr<span class="se">\s</span>hare --&gt; D:<span class="se">\G</span>it<span class="se">\u</span>sr<span class="se">\s</span>hare  
</pre></div></p>
<p>C. 重新运行，如果报 msys-lz4-1.dll not found ，
则下载 liblz4 链接库，下载地址：
<a href="https://repo.msys2.org/msys/x86_64/liblz4-1.9.4-1-x86_64.pkg.tar.zst">https://repo.msys2.org/msys/x86_64/liblz4-1.9.4-1-x86_64.pkg.tar.zst</a>
解压方法同上第二小点，解压后将 liblz4 相关文件复制到 Git 安装目录的对应位置</p>
<p>D. 重新运行，如果报 msys-crypto-1.1.dll not found ，
则将 Git/usr/bin 文件夹里的 msys-crypto-1.0.0.dll 复制一份，并重命名为 msys-crypto-1.1.dll</p>
<h1 id="3-ssh">3. 利用 ssh 使用<a class="headerlink" href="#3-ssh" title="Permanent link"></a></h1>
<p>在本机上打开 git_bash 窗口，在此窗口中通过 ssh 进行与服务器端的文件同步。</p>
<h2 id="31-pull">3.1 下载(pull)<a class="headerlink" href="#31-pull" title="Permanent link"></a></h2>
<div class="highlight"><pre>rsync   <span class="o">[</span>OPTION...<span class="o">]</span>   <span class="o">[</span>USER@<span class="o">]</span>HOST:SRC...    <span class="o">[</span>DEST<span class="o">]</span>   

Pull　　　　　   　　   ---拉取, 下载  
rsync 　　　　 　　     ---备份命令  
<span class="o">[</span>options<span class="o">]</span> 　　  　　　  ---选项  
<span class="o">[</span>USER@<span class="o">]</span>　　    　　  ---目标主机的系统用户  
HOST 　　　　 　　   ---目主机IP地址或域名  
SRC...　　　   　　　 ---目标主机源文件  
<span class="o">[</span>DEST<span class="o">]</span>　　　  　　 　---下载至本地哪个位置  
 <span class="sb">```</span> 
&lt;span <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;color:red;&quot;</span>&gt;例如：rsync -avz  tsmc@172.27.67.172:/home/tsmc/teamip/lh/file ./  &lt;/span&gt;

OPTION选项说明 
<span class="sb">```</span>bash 
-v      详细模式输出  
-a      归档模式，递归的方式传输文件，并保持文件的属性，equals -rlptgoD  
-r      递归拷贝目录  
-l      保留软链接  
-p      保留原有权限  
-t      保留原有时间（修改）  
-g      保留属组权限  
-o      保留属主权限  
-D      等于--devices  --specials    表示支持b,c,s,p类型的文件  
-R      保留相对路径  
-H      保留硬链接  
-A      保留ACL策略  
-e      指定要执行的远程shell命令，ssh更改端口常用选项  
-E      保留可执行权限  
-X      保留扩展属性信息  a属性 
</pre></div>

<h2 id="32-push">3.2 上传(push)<a class="headerlink" href="#32-push" title="Permanent link"></a></h2>
<div class="highlight"><pre>rsync <span class="o">[</span>OPTION...<span class="o">]</span> SRC... <span class="o">[</span>USER@<span class="o">]</span>HOST:DEST    

Push 　　　　　　　　  ---推，上传  
rsync 　　　　　　　　 ---备份命令  
<span class="o">[</span>options<span class="o">]</span> 　　　　　　   ---选项  
SRC...　　　　　　      ---本地源文件  
<span class="o">[</span>USER@<span class="o">]</span> 　　　　　　---目标主机的系统用户  
HOST　　　　　　      ---目主机IP地址或域名  
<span class="o">[</span>DEST<span class="o">]</span> 　　　　　    　---目标对应位置  
 <span class="sb">```</span> 
&lt;span <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;color:red;&quot;</span>&gt;例如： rsync -avz ./C++.pdf tsmc@172.27.67.172:/home/tsmc/teamip/lh/&lt;/span&gt;

<span class="c1"># 4. 通过脚本使用</span>

此脚本是老师创建，用于将项目数据更简洁明了地同步到GPU服务器上。用法如下：
<span class="sb">```</span>bash
./mingw_sync_project_.sh <span class="o">[</span>push<span class="p">|</span>pull<span class="p">|</span>path<span class="o">]</span> user@IP project_dir
<span class="c1"># project_dir指定包含数据集的目录。</span>
</pre></div>

<p>下面以一个实际例子详细展现在 git_bash 上使用此脚本。如下图所示，在 2080TI (IPv6 地址为 2001:da8:a801:69b2:b238:434c:99d7:ac3f ) 的用户目录 tsmc 下有一个文件夹 test_rsync ，该目录下有两个文件夹 A 和 B ，以及一个文件 file 。我们要实现将文件夹 A 和文件 file 同步到自己电脑上，同时不同步 B。</p>
<p style="text-align: center;">
        <img href="/_resources/目录结构.png" alt="">
</p>

<h2 id="41">4.1 创建本地同步目录<a class="headerlink" href="#41" title="Permanent link"></a></h2>
<p>本地机器上创建一个与服务器端（2080TI）相同目录结构的文件夹（需要除去用户根目录）。</p>
<p>按照上述示例，我需要在本地建一个 test_rsync 的文件夹用于与服务器端的同步。具体的，我在 /g/Desktop 路径下建立文件夹 test_rsync</p>
<h2 id="42">4.2 修改脚本<a class="headerlink" href="#42" title="Permanent link"></a></h2>
<p>进入我们刚刚创建的文件夹 test_rsync，将脚本添加到我们刚刚新建的文件夹下。</p>
<p>并修改脚本24-25行，将其中的路径按格式修改为 test_rsync 所在目录的（在命令行输入<span style="color:red;">pwd</span>可以查看当前路径）。</p>
<p>如图所示，在上述示例中路径我们的路径应该改为 /g/Desktop</p>
<div class="highlight"><pre><span class="m">24</span>  <span class="k">if</span> <span class="o">[</span> -e <span class="s2">&quot;/g/Desktop&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>  
<span class="m">25</span>      <span class="nv">DHOME</span><span class="o">=</span>/g/Desktop
</pre></div>

<p style="text-align: center;">
        <img href="/_resources/当前路径.png" alt="">
</p>

<h2 id="43-syncexclude">4.3 新建文件 sync.exclude<a class="headerlink" href="#43-syncexclude" title="Permanent link"></a></h2>
<p>在脚本的同目录下新建文件 sync.exclude（G:\Desktop\LH\sync.exclude），此文件用于排除父文件夹下我们不想同步的目录或文件。按照上述示例，我们是不需要同步 B 文件夹的，因此我们在 sync.exclude 文件中写入 B 文件夹的名称 “B” 即可。</p>
<div class="highlight"><pre>B      <span class="c1"># 文件夹B是我们在同步test_rsync过程中不想让其一起同步的文件夹</span>
</pre></div>

<h2 id="44">4.4 运行<a class="headerlink" href="#44" title="Permanent link"></a></h2>
<p>按照命令格式在 git_bash 上运行脚本(以 pull 为例)</p>
<p><div class="highlight"><pre>./mingw_sync_project_.sh pull user@2408:832f:20b1:97f0:ae1f:6bff:feea:d64f dpCodeBERTmodel_v1/
</pre></div>
如下图所示运行过程中分为两步：</p>
<p>A．  试运行：在命令行键入“y”后，窗口会出现我们想要同步的文件</p>
<p>B．  Pull：如果我们确认需要同步的文件无误后在此键入“y”即可完成本地对服务器的拉取操作</p>
<p style="text-align: center;">
        <img href="/_resources/运行.png" >
</p>

<p>同理，我们如果想上传文件到服务器，只需将上述命令中的pull改为push，命令如下：</p>
<div class="highlight"><pre>./mingw_sync_project_.sh push user@2408:832f:20b1:97f0:ae1f:6bff:feea:d64f dpCodeBERTmodel_v1/
</pre></div></article></body></html>